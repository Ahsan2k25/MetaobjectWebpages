{% assign nested_collections = metaobject.configurator_collections.configurator_nested_collection.value %}
<pre>{{ metaobject | json }}</pre>
<section class="dealer-listing">
  <div class="container">
    <h2 class="dealer-top-heading">
      {{ metaobject.collection_name.value }} Configurators
    </h2>

    <p>Nested Fields: {{ nested_collections }}</p>

    {% if nested_collections and nested_collections.size > 0 %}
      {% for nested in nested_collections %}
        {% assign nested_fields = nested.fields %}

        <div class="nested-collection" id="collection-{{ nested.handle }}">
          <h3>{{ nested_fields.collection_display_name.value }}</h3>

          {% assign product_cards = nested_fields.product_cards.value %}
          <div class="dealer-collections-listing-carousel">
            {% if product_cards and product_cards.size > 0 %}
              {% for card in product_cards %}
                {% assign card_fields = card.fields %}
                <div class="dealer-collections-list-item">
                  <div class="product-image">
                    <img
                      src="{{ card_fields.product_card_image.value | image_url: width: 226, height: 305 }}"
                      alt="{{ card_fields.product_name.value | escape }}"
                      width="226"
                      height="305"
                    >
                  </div>
                  <div class="dealer-collections-list-content">
                    <h4>{{ card_fields.product_name.value }}</h4>
                    {% if card_fields.configure_button_text %}
                      <div class="product-button">
                        <a href="{{ card_fields.configure_button_url.value }}" class="btn">
                          {{ card_fields.configure_button_text.value }}
                        </a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p>No product cards found for this nested collection.</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No nested collections found.</p>
    {% endif %}
  </div>
</section>


{% schema %}
  {
    "name": "Configurator Listing",
    "settings": [],
    "presets": [
      {
        "name": "Configurator Listing"
      }
    ]
  }
{% endschema %}